<!-- <!DOCTYPE html> -->
<html lang=fr>

  <head>
    <title> MySite </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  </head>

  <body>

    {% include 'colors.html' %}

    <style type="text/css">
      body {
        overflow: hidden;
        background-color: var(--page-bg);
      }

      #navigator {
        z-index: 2;
        position: absolute;
        left: 50%;
        transform: translate(-50%, 00%);
      }

      #img-container {
        z-index: 1;
        cursor: grab;
        position: absolute;
        text-align: center;
        background-color: blue;
      }

      #img {
        object-fit: cover
      }
    </style>

    <a class="btn btn-secondary" style="float: left;" href="{% url 'catalogue:detail' object.slug %}"> < </a>


    <div id="navigator">

      <div class="btn-group" role="group">
        <label class='btn btn-primary disabled'>Vitesse zoom </label>
        <button type="button" class="btn btn-primary" onclick="updateZoomStep(-100)">-</button>
        <label id="zoomStep" class='btn btn-primary disabled'> 200 </label>
        <button type="button" class="btn btn-primary" onclick="updateZoomStep(100)">+</button>
      </div>

      <button type="button" class="btn btn-primary" onclick="recenter()">Recentrer</button>


    </div>

    <div id="img-container">
      <img id="img" src="{{object.image.url}}">
    </div>

    <script type="text/javascript">
      const minWidth = 50;
      const imgRatio = 0.8;
      let zoomStep = 200;


      const img = document.getElementById("img");
      const container = document.getElementById("img-container");
      
      recenter();
      zoomElement();
      dragElement(document.getElementById("img-container"));
      updateZoomStep(0);


      function updateZoomStep(dstep) {
        zoomStep += dstep;
        if (zoomStep < 0) {
          zoomStep = 1;
        }
        document.getElementById('zoomStep').innerHTML = zoomStep;
      }

      function zoomElement() {
        let newWidth = 0;
        img.onmousewheel = zoom;

        function zoom(e) {
          if (e.wheelDelta > 0) {
            newWidth = (img.clientWidth + zoomStep);

          }
          else {
            newWidth = (img.clientWidth - zoomStep);

            // prevent too small images
            if (newWidth < minWidth) {
              newWidth = minWidth;
            }
          }

          let ratio = newWidth / img.clientWidth;
          img.style.width = newWidth + "px";

          // move image to focus zoom on mouse position
          container.style.left = (1-ratio) * e.pageX + ratio * container.offsetLeft;
          container.style.top = (1-ratio) * e.pageY + ratio * container.offsetTop;

        }
      }


      function dragElement() {
        var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

        container.onmousedown = dragMouseDown;

        function dragMouseDown(e) {
          container.style.cursor = 'grabbing';

          e = e || window.event;
          e.preventDefault();
          pos3 = e.clientX;
          pos4 = e.clientY;
          document.onmouseup = closeDragElement;
          document.onmousemove = elementDrag;
        }


        function elementDrag(e) {

          e = e || window.event;
          e.preventDefault();
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          container.style.top = (container.offsetTop - pos2) + "px";
          container.style.left = (container.offsetLeft - pos1) + "px";
        }



        function closeDragElement() {
          container.style.cursor = 'grab';
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }

      function recenter() {
        let maxWidth = Math.floor(imgRatio * window.innerWidth);
        let maxHeight = Math.floor(imgRatio * window.innerHeight);

        if (maxHeight / maxWidth < img.clientHeight / img.clientWidth ) {
          maxWidth = maxHeight * img.clientWidth / img.clientHeight;
        }

        img.style.width =  maxWidth + "px";
        container.style.left = Math.floor(0.5 * (window.innerWidth - img.clientWidth)) + "px";
        container.style.top = Math.floor(0.5 * (window.innerHeight - img.clientHeight)) + "px";
      }


    </script>

  </body>

</html>
